[
    {
        "id": "18dd279f36d97386",
        "type": "tab",
        "label": "Button+ modes",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3dc14376c3d7d50c",
        "type": "group",
        "z": "18dd279f36d97386",
        "name": "Requires configuration",
        "style": {
            "label": true,
            "fill": "#ffffbf"
        },
        "nodes": [
            "c42c778490b3be56",
            "9d1dd1afd2f2e0b3",
            "b1a43bc8d228b222"
        ],
        "x": 74,
        "y": 19,
        "w": 472,
        "h": 142
    },
    {
        "id": "1cc89963bcc5d396",
        "type": "debug",
        "z": "18dd279f36d97386",
        "name": "debug 19",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2040,
        "y": 580,
        "wires": []
    },
    {
        "id": "451c39045c64f3cd",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Subscription to generic button MQTT topics",
        "info": "Translates the generic button presses\ninto menu specific button presses\n\nFor insance, when buttonpage = music and button 4 is pressed:\n\nbuttonplus/<device>/button/4/state (press/release/etc)\nis translated into\nbuttonplus/<device>/button/music/4/state (press/release/etc)\n\nThis way, you can let your music player always listen to\nbuttonplus/<device>/button/music/4/state (value: press)\nto increase the volume",
        "x": 210,
        "y": 820,
        "wires": []
    },
    {
        "id": "b27b4b2ef322fadc",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "fetch config",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "page",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "bplusconfig",
                "pt": "msg",
                "to": "#:(file)::bplusconfigdevice",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "pages",
                "pt": "msg",
                "to": "#:(file)::pages",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 520,
        "wires": [
            [
                "5a16a7c2d6e78561"
            ]
        ]
    },
    {
        "id": "5c42b1864a858d07",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "mqttbuttons JSON",
        "func": "context.mqttbuttonsarray = [];\nvar topic = msg.bplusconfig['buttontopic'];\nvar brokerid = msg.bplusconfig['mqttbrokers'];\nbrokerid = brokerid[0].brokerid;\nvar topics = [];\n\nfor (let i = 0; i < 8; i++) {\n  var mqttbuttons_temp = {};\n  mqttbuttons_temp['id'] = i;\n  mqttbuttons_temp['label'] = \" \";\n  mqttbuttons_temp['toplabel'] = \" \";\n  mqttbuttons_temp['ledcolorfront'] = 0;\n  mqttbuttons_temp['ledcolorwall'] = 0;\n  if (i == 0 || i == 1) {\n    topics = [\n      {\n        \"brokerid\": brokerid,\n        \"topic\": topic  + i + \"/state\",\n        \"payload\": \"press\",\n        \"eventtype\": 0\n      },\n      {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/longpress\",\n        \"payload\": \"longpress\",\n        \"eventtype\": 1\n      },\n      {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/state\",\n        \"payload\": \"release\",\n        \"eventtype\": 2\n      }]\n  } else {\n    topics = [\n      {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/state\",\n        \"payload\": \"press\",\n        \"eventtype\": 0\n      }\n      , {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/state\",\n        \"payload\": \"longpress\",\n        \"eventtype\": 1\n      }\n      // // { \"brokerid\": \"ha\",\n      // //   \"topic\": \"buttonplus/wk1/button/\" + buttons[i] + \"/release\",\n      // //   \"payload\": buttons[i].toString(),\n      // //   \"eventtype\": 2 },\n      // ,{ \"brokerid\": \"ha\",\n      //   \"topic\": \"buttonplus/wk1/button/\" + buttons[i] + \"/ledblue\",\n      //   \"payload\": \"on\",\n      //   \"eventtype\": 8 }\n      // ,{ \"brokerid\": \"ha\",\n      //   \"topic\": \"buttonplus/wk1/button/\" + buttons[i] + \"/ledred\",\n      //   \"payload\": \"on\",\n      //   \"eventtype\": 9 }\n      // ,{ \"brokerid\": \"ha\",\n      //   \"topic\": \"buttonplus/wk1/button/\" + buttons[i] + \"/ledgreen\",\n      //   \"payload\": \"on\",\n      //   \"eventtype\": 10 }\n      , {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/label\",\n        // \"payload\": \"\",\n        \"eventtype\": 11\n      }\n      , {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/toplabel\",\n        // \"payload\": \"\",\n        \"eventtype\": 12\n      }\n\n      // ,{ \"brokerid\": \"ha\",\n      //   \"topic\": \"buttonplus/wk1/button/\" + buttons[i] + \"/led\",\n      //   \"payload\": \"on\",\n      //   \"eventtype\": 14 }\n\n      , {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/ledrgb\",\n        \"payload\": \"0\",\n        // .toString()\n        \"eventtype\": 13\n      },\n      {\n        \"brokerid\": brokerid,\n        \"topic\": topic + i + \"/state\",\n        \"payload\": \"release\",\n        \"eventtype\": 2\n      }\n    ]\n  }\n\n  mqttbuttons_temp['topics'] = topics;\n  context.mqttbuttonsarray.push(mqttbuttons_temp);\n}\n// )\n\nmsg.mqttbuttons = context.mqttbuttonsarray;\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 100,
        "wires": [
            [
                "52f51d80a7af1382"
            ]
        ]
    },
    {
        "id": "a2a79e0bbb8e37ee",
        "type": "http request",
        "z": "18dd279f36d97386",
        "name": "Post JSON",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "body",
        "url": "",
        "tls": "",
        "persist": true,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1810,
        "y": 580,
        "wires": [
            [
                "1cc89963bcc5d396"
            ]
        ]
    },
    {
        "id": "85953f5f7ff0a4d4",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Set headers",
        "func": "var ipaddress = msg.ipaddress;\nmsg.url='http://'+ipaddress+'/configsave'\n\nmsg.headers = {};\nmsg.headers[\"Accept\"] = 'application/json';\nmsg.headers[\"Accept-Encoding\"] = 'gzip, deflate, br';\nmsg.headers[\"json\"] = true;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1810,
        "y": 540,
        "wires": [
            [
                "a2a79e0bbb8e37ee"
            ]
        ],
        "icon": "font-awesome/fa-lock"
    },
    {
        "id": "bf5cc3184c6b20f3",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Assemble json object",
        "func": "var configJSON = {};\nvar brightness = flow.get('brightness');\nvar bplusdevice = flow.get('bplusdevice', 'file');\nvar bplusconfig = global.get('bplusconfig', 'file');\nvar configJSONcore = flow.get('configJSONcore', 'file');\n\nvar mqttbrokers = bplusconfig[bplusdevice].mqttbrokers;\nvar id = bplusconfig[bplusdevice].id;\nvar mac = bplusconfig[bplusdevice].mac;\nvar ipaddress = bplusconfig[bplusdevice].ip;\nvar firmware = bplusconfig[bplusdevice].firmware;\nvar location = bplusconfig[bplusdevice].location;\nvar autobackup = bplusconfig[bplusdevice].autobackup;\nvar statusbar = bplusconfig[bplusdevice].statusbar;\nmsg.ipaddress = ipaddress;\n\n\nconfigJSON['core'] = configJSONcore;\n\n\nconfigJSON['mqttbrokers'] = mqttbrokers;\nconfigJSON['mqttdisplays'] = msg.displayitem;\n\n\nmsg.payload = configJSON;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 520,
        "wires": [
            [
                "85953f5f7ff0a4d4"
            ]
        ]
    },
    {
        "id": "678a181d1d45296c",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Update B+",
        "info": "",
        "x": 1780,
        "y": 500,
        "wires": []
    },
    {
        "id": "6d8c3d2b85859530",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "prepare MQTT topics",
        "func": "// Definition of sleep function\n// This prevents overloading of MQTT bus\nfunction sleep(ms) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, ms);\n    });\n}\n\nvar topic = msg.bplusconfig['buttontopic'];\n\nvar page = msg.page+\"/\";\npage = \"\";\n\nfor (var i in msg.label){\n    var newMsg = {};\n    // send label\n    newMsg.payload = msg.label[i];\n    if (newMsg.payload == \"\") { newMsg.payload = \" \" }\n    newMsg.topic = topic+page+i+\"/label\";\n    node.send(newMsg);\n    await sleep(20);\n\n    // send toplabel\n    newMsg.payload = msg.toplabel[i];\n    if (newMsg.payload == \"\") { newMsg.payload = \" \" }\n    newMsg.topic = topic + page +i+\"/toplabel\";\n    node.send(newMsg);\n    await sleep(20);\n    // send led color\n    newMsg.payload = msg.ledrgb[i];\n    newMsg.topic = topic + page +i+\"/ledrgb\";\n    node.send(newMsg);\n    await sleep(20);\n    // send led state\n    // newMsg.payload = msg.led[i];\n    // newMsg.topic = topic + i + \"/led\";\n    // node.send(newMsg);\n}\n\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 240,
        "wires": [
            [
                "ccd034892beae1a0"
            ]
        ]
    },
    {
        "id": "ccd034892beae1a0",
        "type": "mqtt out",
        "z": "18dd279f36d97386",
        "name": "Update buttons",
        "topic": "",
        "qos": "2",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "e6dbd5fb3f32ec20",
        "x": 1380,
        "y": 240,
        "wires": []
    },
    {
        "id": "920ae05b7da02f5e",
        "type": "switch",
        "z": "18dd279f36d97386",
        "name": "06 Switch",
        "property": "buttonpage",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.1",
                "vt": "flow"
            },
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.2",
                "vt": "flow"
            },
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.3",
                "vt": "flow"
            },
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.4",
                "vt": "flow"
            },
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.5",
                "vt": "flow"
            },
            {
                "t": "eq",
                "v": "#:(file)::buttonpages.6",
                "vt": "flow"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 640,
        "y": 300,
        "wires": [
            [
                "542a85206fad321f"
            ],
            [
                "e8889b05d24c5dcb"
            ],
            [
                "7e5b78d7c7fe4627"
            ],
            [
                "fdf83fd0588a899d"
            ],
            [
                "e58c83c87a6fe33e"
            ],
            [
                "aeccd097bb7b6078"
            ]
        ]
    },
    {
        "id": "7999247d642a01a5",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Send configJSON['core']",
        "func": "var configJSON = {};\nvar brightness = flow.get('brightness');\nvar bplusdevice = flow.get('bplusdevice', 'file');\nvar bplusconfig = global.get('bplusconfig', 'file');\nvar mqttbrokers = bplusconfig[bplusdevice].mqttbrokers;\nvar id = bplusconfig[bplusdevice].id;\nvar mac = bplusconfig[bplusdevice].mac;\nvar ipaddress = bplusconfig[bplusdevice].ip;\nvar firmware = bplusconfig[bplusdevice].firmware;\nvar location = bplusconfig[bplusdevice].location;\nvar autobackup = bplusconfig[bplusdevice].autobackup;\nvar statusbar = bplusconfig[bplusdevice].statusbar;\nmsg.ipaddress = ipaddress;\n\n// configJSON['info'] = {\n//   \"id\": id,\n//   \"mac\": mac,\n//   \"ipaddress\": ipaddress,\n//   \"firmware\": firmware,\n//   \"largedisplay\": 0,\n//   \"connectors\": [\n//     { \"id\": 0, \"type\": 2 },\n//     { \"id\": 1, \"type\": 1 },\n//     { \"id\": 2, \"type\": 1 },\n//     { \"id\": 3, \"type\": 1 }\n//   ],\n//   \"sensors\": [\n//     { \"sensorid\": 1, \"description\": \"Sensirion STS35 Temperature Sensor\" }\n//   ]\n// }\n\nconfigJSON['core'] = {\n  \"name\": id,\n  \"location\": location,\n  \"autobackup\": autobackup,\n  \"brightnesslargedisplay\": brightness,\n  \"brightnessminidisplay\": brightness,\n  \"ledcolorfront\": 0,\n  \"ledcolorwall\": 0,\n  \"color\": 0,\n  \"statusbar\": statusbar\n}\n\nmsg.payload = configJSON;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 780,
        "wires": [
            [
                "85953f5f7ff0a4d4"
            ]
        ]
    },
    {
        "id": "8c7c530121f06c0a",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Parse brightness from MQTT",
        "func": "var brightness = parseInt(msg.payload);\nflow.set('brightness', brightness);\nmsg.brightness = brightness;\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 740,
        "wires": [
            [
                "7999247d642a01a5"
            ]
        ]
    },
    {
        "id": "9e5c458fc0c9a42c",
        "type": "mqtt in",
        "z": "18dd279f36d97386",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6dbd5fb3f32ec20",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 170,
        "y": 900,
        "wires": [
            [
                "69c074c0b157fb0f"
            ]
        ]
    },
    {
        "id": "69c074c0b157fb0f",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Split topic",
        "func": "var topic = msg.topic;\ntopic = topic.split(\"/\");\n\nvar buttonpageid = flow.get(\"buttonpageid\")\nvar buttonpages = flow.get(\"buttonpages\", \"file\");\nvar button = topic[3];\n\nvar mainbutton = flow.get(\"bplusconfigbuttons\", \"file\").mainbutton;\n\nif (mainbutton[button] == \"main\"){\n    var buttonpage = buttonpages[0];\n}else{\n    var buttonpage = buttonpages[buttonpageid];\n}\n\nmsg.buttonpage = buttonpage;\nmsg.button = topic[3];\nmsg.state = msg.payload;\n// msg.buttonpageid = buttonpageid;\n\nvar basetopic = topic[0];\nvar device = topic[1];\nvar newtopic = [basetopic, device, \"button\", buttonpage,button,\"state\"];\nmsg.topic = newtopic.join(\"/\");\n\nreturn msg;  ",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 900,
        "wires": [
            [
                "5a18a8146233329f",
                "360959b6396226a4",
                "acd5a8cdd7fdab94"
            ]
        ]
    },
    {
        "id": "e9feb78c7c682c81",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Trigger to change menu via MQTT",
        "info": "",
        "x": 160,
        "y": 440,
        "wires": []
    },
    {
        "id": "4e93887143e892f2",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Listen to brightness triggers",
        "info": "Partial update of B+",
        "x": 1200,
        "y": 620,
        "wires": []
    },
    {
        "id": "024763858b861b96",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Trigger update of B+ when configuration has changed",
        "info": "Trigger update of B+ when configuration has changed\n\nWill update the MQTT topics of the buttons ",
        "x": 1040,
        "y": 60,
        "wires": []
    },
    {
        "id": "dadb8ffa780eaf8f",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Update MQTT topics for button labels ",
        "info": "",
        "x": 1250,
        "y": 300,
        "wires": []
    },
    {
        "id": "18520d4ccc30f2dd",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Prepare Displayitems JSON",
        "info": "based on upstream definition",
        "x": 1040,
        "y": 480,
        "wires": []
    },
    {
        "id": "0b84f1ab4bd32c4a",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Combine JSON objects",
        "info": "and prepare upload to JSON",
        "x": 1280,
        "y": 480,
        "wires": []
    },
    {
        "id": "c42c778490b3be56",
        "type": "function",
        "z": "18dd279f36d97386",
        "g": "3dc14376c3d7d50c",
        "name": "01 global config",
        "func": "// Configuration goes here:\nvar bplusdevice = \"wk1\"; // the device this page belongs to\n\n// nothing to be changed below this line\n// -------------------------------------\n\n// retrieve existing config from disk, or create when non-existent\n// this retrieves configuration for all configured B+ devices\nvar bplusconfig = global.get(\"bplusconfig\", \"file\");\nvar bplusconfigbuttons = global.get('bplusconfigbuttons','file');\nvar bplusconfigdisplayitems = global.get('bplusconfigdisplayitems', 'file');\n\n\n\n\nvar buttonpages = bplusconfig[bplusdevice].buttonpages;\nvar pages = bplusconfig[bplusdevice].pages;\n\n\n// retrieve existing config from disk, or create when non-existent\n// this retrieves configuration for all configured B+ devices\nvar bplusconfig = global.get(\"bplusconfig\", \"file\");\nif (bplusconfig == undefined) {\n    bplusconfig = {};\n\n}\n\n\n\nvar label = bplusconfigbuttons[bplusdevice].label;\nvar toplabel = bplusconfigbuttons[bplusdevice].toplabel;\nvar ledrgb = bplusconfigbuttons[bplusdevice].ledrgb;\nvar mainbutton = bplusconfigbuttons[bplusdevice].mainbutton;\n\nfor (var i in label) {\n    for (var j in label[i]) {\n\n        if (mainbutton[j] == \"main\") {\n            var label_thisbutton = label[i];\n            var label_mainbutton = label[0];\n            label_thisbutton[j] = label_mainbutton[j];\n        }\n        label[i] = label_thisbutton;\n    }\n}\n\nfor (var i in toplabel) {\n    for (var j in toplabel[i]) {\n\n        if (mainbutton[j] == \"main\") {\n            var label_thisbutton = toplabel[i];\n            var label_mainbutton = toplabel[0];\n            label_thisbutton[j] = label_mainbutton[j];\n        }\n        toplabel[i] = label_thisbutton;\n    }\n}\n\nfor (var i in ledrgb) {\n    for (var j in ledrgb[i]) {\n\n        if (mainbutton[j] == \"main\") {\n            var label_thisbutton = ledrgb[i];\n            var label_mainbutton = ledrgb[0];\n            label_thisbutton[j] = label_mainbutton[j];\n        }\n        ledrgb[i] = label_thisbutton;\n    }\n}\n\n\nbplusconfigbuttons = {\n    'label': label,\n    'toplabel': toplabel,\n    'ledrgb': ledrgb,\n    'mainbutton': mainbutton\n}\n\n\n\n\n// save the configuration and parameters to this flow, for use\n// flow.set('bplusdevice', bplusdevice, \"file\");\n// flow.set('bplusconfigdevice', bplusconfig[bplusdevice], \"file\");\nflow.set('pages',pages,\"file\");\nflow.set('buttonpages', buttonpages, \"file\");\nflow.set('configJSONcore', bplusconfig[bplusdevice].configJSONcore, \"file\");\nflow.set('bplusconfigdisplayitems',bplusconfigdisplayitems[bplusdevice]);\n\n// save the configuration and parameters to this flow, for use\nflow.set('bplusdevice', bplusdevice, \"file\");\nflow.set('bplusconfigdevice', bplusconfig[bplusdevice], \"file\");\nflow.set('bplusconfigbuttons', bplusconfigbuttons, 'file')\n\n\n\n// // save the config of all devices back to the disk\n// global.set(\"bplusconfig\", bplusconfig, \"file\")\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 60,
        "wires": [
            [
                "c43be3884888dc48"
            ]
        ]
    },
    {
        "id": "9d1dd1afd2f2e0b3",
        "type": "inject",
        "z": "18dd279f36d97386",
        "g": "3dc14376c3d7d50c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "v": "#:(file)::bplusconfigdevice.updatetopic",
                "vt": "flow"
            },
            {
                "p": "action",
                "v": "subscribe",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 60,
        "wires": [
            [
                "c42c778490b3be56",
                "b1a43bc8d228b222"
            ]
        ]
    },
    {
        "id": "fb7ab37fc1f0876e",
        "type": "inject",
        "z": "18dd279f36d97386",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "v": "#:(file)::bplusconfigdevice.buttonsubscriptiontopic",
                "vt": "flow"
            },
            {
                "p": "action",
                "v": "subscribe",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 860,
        "wires": [
            [
                "9e5c458fc0c9a42c"
            ]
        ]
    },
    {
        "id": "18c856d5c82682a7",
        "type": "mqtt in",
        "z": "18dd279f36d97386",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6dbd5fb3f32ec20",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 150,
        "y": 520,
        "wires": [
            [
                "b27b4b2ef322fadc"
            ]
        ]
    },
    {
        "id": "5beb334d81c4c07b",
        "type": "inject",
        "z": "18dd279f36d97386",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "v": "#:(file)::bplusconfigdevice.pagetopic",
                "vt": "flow"
            },
            {
                "p": "action",
                "v": "subscribe",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 480,
        "wires": [
            [
                "18c856d5c82682a7"
            ]
        ]
    },
    {
        "id": "fd482d5e89b7c1a7",
        "type": "mqtt in",
        "z": "18dd279f36d97386",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6dbd5fb3f32ec20",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 1170,
        "y": 700,
        "wires": [
            [
                "8c7c530121f06c0a"
            ]
        ]
    },
    {
        "id": "d641ca2af3348273",
        "type": "inject",
        "z": "18dd279f36d97386",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "v": "#:(file)::bplusconfigdevice.brightnesstopic",
                "vt": "flow"
            },
            {
                "p": "action",
                "v": "subscribe",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1170,
        "y": 660,
        "wires": [
            [
                "fd482d5e89b7c1a7"
            ]
        ]
    },
    {
        "id": "e7627788f729cca5",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "fetch config",
        "rules": [
            {
                "t": "set",
                "p": "buttonpage",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "bplusconfig",
                "pt": "msg",
                "to": "#:(file)::bplusconfigdevice",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "buttonpage",
                "pt": "flow",
                "to": "buttonpage",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 300,
        "wires": [
            [
                "920ae05b7da02f5e",
                "87ee8d61ca60d62d"
            ]
        ]
    },
    {
        "id": "52f51d80a7af1382",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Assemble json object",
        "func": "var configJSON = {};\nvar bplusdevice = flow.get('bplusdevice', 'file');\nvar bplusconfig = global.get('bplusconfig', 'file');\nvar configJSONcore = flow.get('configJSONcore', 'file');\n\n// var mqttbrokers = bplusconfig[bplusdevice].mqttbrokers;\n\nmsg.ipaddress = bplusconfig[bplusdevice].ip;\n\nconfigJSON['core'] = configJSONcore;\n\n// configJSON['mqttbrokers'] = mqttbrokers;\nconfigJSON['mqttbuttons'] = msg.mqttbuttons;\n\n\nmsg.payload = configJSON;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 100,
        "wires": [
            [
                "85953f5f7ff0a4d4",
                "ebc38199c9732748"
            ]
        ]
    },
    {
        "id": "c43be3884888dc48",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "fetch config",
        "rules": [
            {
                "t": "set",
                "p": "bplusconfig",
                "pt": "msg",
                "to": "#:(file)::bplusconfigdevice",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 100,
        "wires": [
            [
                "5c42b1864a858d07"
            ]
        ]
    },
    {
        "id": "5a18a8146233329f",
        "type": "debug",
        "z": "18dd279f36d97386",
        "name": "debug 37",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 280,
        "y": 1000,
        "wires": []
    },
    {
        "id": "5a16a7c2d6e78561",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Initialize displayitem JSON",
        "func": "var page = msg.page;\nvar pages = flow.get(\"pages\", \"file\");\n\nvar pageid = pages.indexOf(page);\n// msg.pageid = pageid;\nflow.set(\"pageid\", pageid);\n\n\nvar pages = flow.get(\"pages\", \"file\");\n\n\nvar displayitems = flow.get(\"bplusconfigdisplayitems\");\n\n\nvar displayitems_new = [];\n\nfor (let i = 0; i < displayitems.length; i++) {\n    if (displayitems[i].page == 0 || displayitems[i].page == pageid) {\n    displayitems_new.push(displayitems[i]);}\n    \n}\n\n\n\n// Initialize displayitem JSON\n\n// msg.filter = filter;\n// msg.displayitems = displayitems;\nmsg.displayitems = displayitems_new;\n\n// Initialize displayitem JSON\nmsg.displayitem = [];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 520,
        "wires": [
            [
                "21d5669fd64848d1",
                "6374731ef808ee9b"
            ]
        ]
    },
    {
        "id": "542a85206fad321f",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 1 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.1.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.1.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.1.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 200,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "e8889b05d24c5dcb",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 2 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.2.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.2.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.2.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 240,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "7e5b78d7c7fe4627",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 3 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.3.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.3.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.3.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 280,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "fdf83fd0588a899d",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 4 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.4.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.4.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.4.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 320,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "e58c83c87a6fe33e",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 5 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.5.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.5.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.5.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 360,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "aeccd097bb7b6078",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "draw button page 6 label",
        "rules": [
            {
                "t": "set",
                "p": "label.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "label.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.label.6.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "toplabel.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.toplabel.6.7",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.0",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.0",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.1",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.1",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.2",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.2",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.3",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.3",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.4",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.4",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.5",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.5",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.6",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.6",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "ledrgb.7",
                "pt": "msg",
                "to": "#:(file)::bplusconfigbuttons.ledrgb.6.7",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 400,
        "wires": [
            [
                "6d8c3d2b85859530"
            ]
        ]
    },
    {
        "id": "87ee8d61ca60d62d",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "save buttonpageid",
        "func": "var buttonpage = msg.buttonpage;\nvar buttonpages = flow.get(\"buttonpages\",\"file\");\n\nvar buttonpageid = buttonpages.indexOf(buttonpage);\nmsg.buttonpageid = buttonpageid;\nflow.set(\"buttonpageid\", buttonpageid);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "21d5669fd64848d1",
        "type": "debug",
        "z": "18dd279f36d97386",
        "name": "debug 39",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 580,
        "wires": []
    },
    {
        "id": "6374731ef808ee9b",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "add topics",
        "func": "var displayitem = msg.displayitems;\nvar topic = msg.bplusconfig['displaytopic'];\nvar brokerid = msg.bplusconfig['mqttbrokers'][0]['brokerid'];\nvar page = msg.page;\nvar pages = msg.pages;\n\n// Walk through all display items and add required JSON\nfor (var i in displayitem) {\n    // if (typeof displayitem[i] === 'object') {\n        displayitem[i]['topics'] = [{\n            \"brokerid\": brokerid,\n            \"topic\": topic + pages[displayitem[i]['page']] + \"/\" + displayitem[i]['displayitem'] + \"/value\",\n            \"eventtype\": 15\n        }, {\n            \"brokerid\": brokerid, \"topic\": topic + pages[displayitem[i]['page']] + \"/\" + displayitem[i]['displayitem'] + \"/label\",\n            \"eventtype\": 16\n        }, {\n            \"brokerid\": brokerid, \"topic\": topic + pages[displayitem[i]['page']] + \"/\" + displayitem[i]['displayitem'] + \"/uom\",\n            \"eventtype\": 17\n        }\n        ]\n        // var newMsg = {};\n        // newMsg.error = displayitem[i];\n        // node.send(newMsg);\n    // delete displayitem[i].displayitem;\n    // delete displayitem[i].page;\n    // }\n};\n\n// // Cleanup array\n// var newarray = [];\n// var j = 0;\n// for (let i = 0; i < displayitem.length; i++) {\n//     if (displayitem[i] !== undefined) {\n//         newarray[j] = displayitem[i];\n//         j = j + 1;\n//     }\n// }\n\n// msg.displayitem = newarray;\nmsg.displayitem = displayitem;\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 520,
        "wires": [
            [
                "bf5cc3184c6b20f3"
            ]
        ]
    },
    {
        "id": "360959b6396226a4",
        "type": "mqtt out",
        "z": "18dd279f36d97386",
        "name": "",
        "topic": "",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "e6dbd5fb3f32ec20",
        "x": 590,
        "y": 880,
        "wires": []
    },
    {
        "id": "acd5a8cdd7fdab94",
        "type": "link out",
        "z": "18dd279f36d97386",
        "name": "Buttonplus WK1 button clicks",
        "mode": "link",
        "links": [
            "959c774849e00892"
        ],
        "x": 670,
        "y": 1000,
        "wires": [],
        "l": true
    },
    {
        "id": "b1a43bc8d228b222",
        "type": "mqtt in",
        "z": "18dd279f36d97386",
        "g": "3dc14376c3d7d50c",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6dbd5fb3f32ec20",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 270,
        "y": 120,
        "wires": [
            [
                "c42c778490b3be56"
            ]
        ]
    },
    {
        "id": "37e30e2131181dd3",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Trigger to change buttonmenu via MQTT",
        "info": "",
        "x": 160,
        "y": 200,
        "wires": []
    },
    {
        "id": "58fbb0dc6d528c39",
        "type": "mqtt in",
        "z": "18dd279f36d97386",
        "name": "",
        "topic": "",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6dbd5fb3f32ec20",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 1,
        "x": 130,
        "y": 300,
        "wires": [
            [
                "e7627788f729cca5"
            ]
        ]
    },
    {
        "id": "723ba4c860a83c0e",
        "type": "inject",
        "z": "18dd279f36d97386",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "v": "#:(file)::bplusconfigdevice.buttonpagetopic",
                "vt": "flow"
            },
            {
                "p": "action",
                "v": "subscribe",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 240,
        "wires": [
            [
                "58fbb0dc6d528c39"
            ]
        ]
    },
    {
        "id": "0d5f157421728820",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Optional: use button presses within Node Red",
        "info": "This can link to a node on another flow",
        "x": 710,
        "y": 960,
        "wires": []
    },
    {
        "id": "0d90e8ce00e6f73a",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Page specific button topics",
        "info": "use for direct subscription to a button press",
        "x": 660,
        "y": 840,
        "wires": []
    },
    {
        "id": "ebc38199c9732748",
        "type": "debug",
        "z": "18dd279f36d97386",
        "name": "debug 40",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 100,
        "wires": []
    },
    {
        "id": "b7ca85d28659e4ee",
        "type": "function",
        "z": "18dd279f36d97386",
        "name": "Assemble json object",
        "func": "var configJSON = {};\nvar bplusdevice = flow.get('bplusdevice', 'file');\nvar bplusconfig = flow.get('bplusconfigdevice', 'file');\nvar configJSONcore = flow.get('configJSONcore', 'file');\n\n\n\nmsg.ipaddress = bplusconfig.ip;\nvar mqttbrokers = bplusconfig.mqttbrokers;\n\nconfigJSON['core'] = configJSONcore;\n\nconfigJSON['mqttbrokers'] = mqttbrokers;\n\n\n\nmsg.payload = configJSON;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 1000,
        "wires": [
            [
                "85953f5f7ff0a4d4"
            ]
        ]
    },
    {
        "id": "5dcbb87dfd981097",
        "type": "change",
        "z": "18dd279f36d97386",
        "name": "fetch config",
        "rules": [
            {
                "t": "set",
                "p": "bplusconfig",
                "pt": "msg",
                "to": "#:(file)::bplusconfigdevice",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1290,
        "y": 960,
        "wires": [
            [
                "b7ca85d28659e4ee"
            ]
        ]
    },
    {
        "id": "fc91caed9af12340",
        "type": "inject",
        "z": "18dd279f36d97386",
        "name": "Resend MQTT broker to B+",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1260,
        "y": 920,
        "wires": [
            [
                "5dcbb87dfd981097"
            ]
        ]
    },
    {
        "id": "b93bc4ba3c8814bf",
        "type": "comment",
        "z": "18dd279f36d97386",
        "name": "Normally not needed",
        "info": "",
        "x": 1270,
        "y": 880,
        "wires": []
    },
    {
        "id": "e6dbd5fb3f32ec20",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.1.7",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    }
]
